<!DOCTYPE html>
<html>
<head>    	
    <script src="/socket.io/socket.io.js"></script>
    <script src="phaser.js"></script>
    <script src="src/preloader.js"></script>
    <script src="src/gamescene.js"></script>
    <script src="src/menuscene.js"></script>
    <script src="src/storyboard.js"></script>
    <script src="src/credits.js"></script>
    <script src="src/addons.js"></script>
    <script src="src/bullet.js"></script>
    <script src="src/enemy.js"></script>
    <script src="src/enemytest.js"></script>
</head>
<body>

    <script>
    var socket = io();
    var config = {
        type: Phaser.AUTO,
        width: 1280,
        height: 1280, 
        input: {
            gamepad: true
        },
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 400 }
            }
        },
        scene: [ Preloader, MainMenu, GameScene ]
    };

    //Globals
    var map;
    var player;
    var mv_speed = 250;
    var jumpButton,jumpTimer;
    var scoreText;
    var jump_vel = 440;
    var enemies;
    var enemies2;
    var bullets;
    var speed;
    var lastFired = 0;
    var emitter0;
    var new_enemy;
    var spawner;
    var spawnlayer;
    //Functions
    function test(){
        console.log("test");
    }
    function spawnEnemies(){
        console.log("timer spawner!");
        if(spawnlayer){
            var spawns = spawnlayer.objects;
            if(enemies.countActive() < 10){
                //Spawn a new enemy every 1 seconds at a random spawner
                var value = Phaser.Math.Between(0, spawns.length-1);
                new_enemy = enemies.get();
                if(new_enemy){
                    //Setup Enemy
                    new_enemy.setActive(true);
                    new_enemy.setVisible(true);
                    new_enemy.setPosition(spawns[value].x,spawns[value].y);
                    new_enemy.body.setBounce(0.1);
                    
                } 
            }
        }   
    }
    function damageEnemy(enemy, bullet) {  
        // only if both enemy and bullet are alive
        if (enemy.active === true && bullet.active === true) {
            // we remove the bullet right away
            bullet.setActive(false);
            bullet.setVisible(false);    
            
            // decrease the enemy hp with BULLET_DAMAGE
            enemy.receiveDamage(bullet.damage);
        }
    }   
    
    function bulletHitGround(spr1,spr2){
        emitter0.active = true;
        emitter0.explode(5,spr1.x,spr1.y);
        spr1.hit();

    }
    function damagePlayer(p,b){
        emitter0.active = true;
        emitter0.explode(5,p.x,p.y);
        p.hp--;

    }
    //Gun Object Template
    function Gun(rof,magsize,reloadtime){
        this.rofct = rof;
        this.rof  = rof;
        this.magsize = magsize;
        this.magsizect = magsize;
        this.reload = reloadtime;
        this.reloadct = reloadtime;
        this.reloading = false;
        this.ready = true;
        this.shoot = function(){
            this.magsizect--;
            if(this.magsizect <= 0){
                this.ready = false;
                this.reloading = true;
            }
        }
        this.update = function(){

            if(this.reloading){
                this.reloadct--;
                if(this.reloadct <= 0){
                    this.reloading = false;
                    this.magsizect = magsize;
                    this.reloadct = this.reload;
                }
            }else{
                this.rofct--;
                if(this.rofct <= 0){
                    this.ready = true;
                    this.rofct = this.rof;
                }else{
                    this.ready = false;
                }
            }
        }
    }
    //Game
    var game = new Phaser.Game(config);

    </script>

</body>
</html>